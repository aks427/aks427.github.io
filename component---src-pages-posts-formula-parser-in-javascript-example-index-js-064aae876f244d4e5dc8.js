(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{"0PNO":function(e,t,r){"use strict";r.r(t);var n=r("qKvR"),u=r("q1tI"),o=r("TJpk"),a=r("Bl7J");function i(e){var t=e.peek(),r=e.getPreviousToken(),n=r?r.type:null;return'"'===t?(e.next(),"string"===n||"start quote"===n?"end quote":"start quote"):'"'!==t&&"start quote"===n&&'"'===r.value?(e.match(/^[^"]+(?=")/,!0)||e.match(/^[^"]+/,!0),"string"):e.match(/^[-]?\d*\.?\d+/,!1)?"-"===t&&"operator"!==n&&c(r)?(e.next(),"operator"):(e.match(/^[-]?\d*\.?\d+/,!0),"number"):["&","*","-","+","/"].indexOf(t)>-1?(e.next(),"operator"):"bracket"===n&&"["===r.value&&e.match(/^[^[\]]+(?=\])/,!0)?"reference-name":e.match(/^[a-zA-Z_]\w*(?=\()/,!0)?"function-name":[")","]","(","["].indexOf(t)>-1?(e.next(),"bracket"):","===t?(e.next(),"comma"):e.match(/^ +/,!0)?"whitespace":(e.next(),"error")}function c(e){return!!e&&("number"===e.type||"end quote"===e.type||"bracket"===e.type&&(")"===e.value||"]"===e.value))}var l={"&":function(e){return e.join("")},"+":function(e){return Number(e[0])+Number(e[1])},"-":function(e){return Number(e[0])-Number(e[1])},"/":function(e){return Number(e[0])/Number(e[1])},"*":function(e){return Number(e[0])*Number(e[1])}};var p={upper:function(e){if(e.length>0)return e[0].toUpperCase();return""},round:function(e){if(e.length>0)return Math.round(e[0]);return""}};function s(e){return!e||("operator"===e.type||"comma"===e.type||"bracket"===e.type&&"("===e.value)}r("TpD0");function f(e){var t=e.value,r=e.onChange,o=e.onErrorsChanged,a=e.onTokensChanged,l=Object(u.useRef)(),f=Object(u.useRef)(),h=Object(u.useState)(30),v=h[0],b=h[1],m=Object(u.useState)([]),d=m[0],y=m[1],g=Object(u.useState)([]),k=g[0],O=g[1];Object(u.useEffect)((function(){var e=function(e,t){for(var r=0,n=[],u=function(){return r>=e.length},o=function(){return u()?null:e.substring(r,r+1)},a=function(t,n){var u=e.substring(r).match(t);return!u||u.length>1?null:(n&&(r+=u[0].length),u[0]||null)},i=function(){return r+=1,o()},c=function(){for(var e=n.length-1;e>=0;e--)if("whitespace"!==n[e].type)return n[e];return null};!u();){var l=r,p=t({peek:o,match:a,next:i,isEnd:u,getPreviousToken:c});if(l===r)throw new Error("Tokenizer did not move forward");var s={value:e.substring(l,r),type:p};n.push(s)}return n}(t,i),r=function(e){for(var t,r=[],n=[],u=null,o=0,a=e.filter((function(e){return"whitespace"!==e.type})),i=0;i<a.length;i++){var l=a[i],f=u?u.type:null;"operator"===l.type&&(c(u)||r.push({token:l,error:"Unexpected operator '"+l.value+"'"}),i===a.length-1&&r.push({token:l,error:"Value expected after operator '"+l.value+"'"})),"number"===l.type&&(s(u)||r.push({token:l,error:"An operator is required before the number"})),"function-name"===l.type&&(s(u)||r.push({token:l,error:"An operator is required before the function"}),t=l.value,p[t.toLowerCase()]||r.push({token:l,error:"'"+l.value+"' is not a valid function"})),"start quote"===l.type&&(n.push({text:'"',type:"reference",token:l}),s(u)||r.push({token:l,error:"An operator is required before the string"})),"end quote"===l.type&&n.length>0&&'"'===n[n.length-1].text&&n.pop(),"comma"===l.type&&(!o>0&&r.push({token:l,error:"Unexpected ','"}),c(u)||r.push({token:l,error:"Unexpected ','"})),"bracket"===l.type&&("("===l.value&&(n.push({text:"(",type:"function-name"===f?"function":"group",token:l}),"function-name"===f&&(o+=1),"function-name"===f||s(u)||r.push({token:l,error:"An operator is required before the parenthesis"})),")"===l.value&&(n.length>0&&"("===n[n.length-1].text?("function"===n[n.length-1].type&&o--,n.pop(),c(u)||"start-parenthesis"===f&&"function"===n[n.length-1].type||r.push({token:l,error:"Unexpected ')'"})):r.push({token:l,error:"Unexpected ')'"})),"["===l.value&&(n.push({text:"[",type:"reference",token:l}),s(u)||r.push({token:l,error:"An operator is required before the reference"})),"]"===l.value&&(n.length>0&&"["===n[n.length-1].text?("reference-name"!==f&&r.push({token:l,error:"A reference name is required in the brackets"}),n.pop()):r.push({token:l,error:"Unexpected ']'"}))),u=l}for(var h=0,v=n;h<v.length;h++){var b=v[h],m=b.text;"("===b.text?m=")":"["===b.text&&(m="]"),r.push({token:b.token,error:"Missing closing '"+m+"'"})}return r}(e);y(e),O(r),a&&a(e),o&&o(r)}),[t,a,o]),Object(u.useLayoutEffect)((function(){var e=l.current,t=function(){f.current.scrollTop=l.current.scrollTop,f.current.scrollLeft=l.current.scrollLeft};return e.addEventListener("scroll",t),function(){e.removeEventListener("scroll",t)}}),[l]),Object(u.useLayoutEffect)((function(){l.current.style.height="auto",l.current.style.height=Math.min(l.current.scrollHeight+2,200)+"px",b(l.current.scrollHeight+2)}),[t]);return Object(n.b)("div",{className:"formula-editor"},Object(n.b)("textarea",{value:t,onChange:function(e){var t=e.target.value;t&&(t=t.replace(/(?:\r\n|\r|\n)/g,"")),r(t)},className:"formula-editor-textarea",ref:l,autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",height:v,rows:1}),Object(n.b)("div",{className:"formula-editor-formatted",ref:f},function(e,t){for(var r=[],u=function(u){var o=e[u],a=[o.type];t.filter((function(e){return e.token===o})).length>0&&a.push("error"),r.push(Object(n.b)("span",{key:u,className:a.join(" ")},o.value))},o=0;o<e.length;o++)u(o);return r}(d,k)))}function h(e,t){var r=e[e.length-1];r&&"operator"===r.type&&r.innerNodes.length<2?r.innerNodes.push(t):e.push(t)}function v(e){var t,r=[],n=[];for(t=0;t<e.length;t++){if("bracket"===e[t].type){if(")"===e[t].value&&"("===n[n.length-1]&&(n.pop(),0===n.length)){t++;break}if("("===e[t].value&&(n.push(e[t].value),0===t))continue}r.push(e[t])}return{tokens:r,i:t-1}}function b(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return m(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return m(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(r=e[Symbol.iterator]()).next.bind(r)}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function d(e,t){for(var r,n="",u=b(function e(t){for(var r=[],n=t.filter((function(e){return"whitespace"!==e.type})),u=0;u<n.length;u++){var o=n[u];if(!(["start quote","end quote"].indexOf(o.type)>-1)){if(["string","number"].indexOf(o.type)>-1&&h(r,{type:o.type,value:o.value}),"operator"===o.type){var a=r[r.length-1];r.pop(),r.push({type:"operator",value:o.value,innerNodes:[a]})}if("reference-name"===o.type&&h(r,{type:"reference",value:o.value}),"function-name"===o.type){var i=[];if(n[++u]&&"bracket"===n[u].type&&"("===n[u].value){var c=v(n.slice(u));i=c.tokens,u+=c.i}h(r,{type:"function",value:o.value,innerNodes:e(i)})}if("bracket"===o.type&&"("===o.value){var l=v(n.slice(u));u+=l.i;var p=l.tokens;h(r,{type:"group",innerNodes:p?e(p):null})}}}return console.log(JSON.stringify(r)),r}(e));!(r=u()).done;){n+=y(r.value,t)}return n}function y(e,t){if(!e)return"";if("operator"===e.type){var r=e.innerNodes.map((function(e){return y(e,t)}));return function(e,t){var r=l[e];return r?r(t):""}(e.value,r)}if("function"===e.type){var n=e.innerNodes.map((function(e){return y(e,t)}));return function(e,t){var r=p[e.toLowerCase()];return r?r(t):""}(e.value,n)}return"reference"===e.type?t[e.value]||"":"string"===e.type||"number"===e.type?e.value:""}function g(e,t){var r=function(e){if(!e)return null;return JSON.parse(JSON.stringify(e))}(e);return r[t.propertyName]=t.value,r}r("XuOu"),t.default=function(){var e,t,r,i,c=Object(u.useState)('"Hello " & [First Name] & "! " & Round(1.2 + [Some Number])'),l=c[0],p=c[1],s=Object(u.useState)([]),h=s[0],v=s[1],b=Object(u.useState)([]),m=b[0],y=b[1],k=(e={"First Name":"Andrew","Some Number":3},t=Object(u.useReducer)(g,e),r=t[0],i=t[1],[r,function(e,t){i({propertyName:e,value:t})}]),O=k[0],j=k[1],x=function(e){return e.filter((function(e){return"reference-name"===e.type})).map((function(e){return e.value})).filter((function(e,t,r){return r.indexOf(e)===t}))}(m),N=d(m,O);return Object(n.b)(a.a,null,Object(n.b)(o.Helmet,null,Object(n.b)("title",null,"Parser Example")),Object(n.b)("div",{className:"formula-example"},Object(n.b)("p",null,"This is an example for the ",Object(n.b)("a",{href:"/posts/formula-parser-in-javascript"},"Write a simple formula parser in JavaScript")," post."),Object(n.b)("p",null,"This shows the editor, validator and evaluator all working together."),Object(n.b)("h3",null,"Editor"),Object(n.b)(f,{value:l,onChange:p,onErrorsChanged:v,onTokensChanged:y}),h.map((function(e,t){return Object(n.b)("div",{key:t,className:"error"},e.error)})),x.length>0?Object(n.b)("h3",null,"References"):null,x.map((function(e){return Object(n.b)("div",{key:e,className:"input-value"},Object(n.b)("div",null,e),Object(n.b)("input",{value:O[e]||"",onChange:function(t){return j(e,t.target.value)}}))})),Object(n.b)("h3",null,"Result"),Object(n.b)("div",{className:"result"},N)))}},TpD0:function(e,t,r){},XuOu:function(e,t,r){}}]);
//# sourceMappingURL=component---src-pages-posts-formula-parser-in-javascript-example-index-js-064aae876f244d4e5dc8.js.map